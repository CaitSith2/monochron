   1               		.file	"anim_gps.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__CCP__  = 0x34
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  12               		.text
  13               	.Ltext0:
 136               	.global	initanim_GPS
 138               	initanim_GPS:
 139               		.stabd	46,0,0
   0:anim_gps.c    **** #include <avr/io.h>      // this contains all the IO port definitions
   1:anim_gps.c    **** #include <avr/interrupt.h>
   2:anim_gps.c    **** #include <util/delay.h>
   3:anim_gps.c    **** #include <avr/pgmspace.h>
   4:anim_gps.c    **** #include <avr/eeprom.h>
   5:anim_gps.c    **** #include <avr/wdt.h>
   6:anim_gps.c    **** #include <string.h>
   7:anim_gps.c    **** #include <stdlib.h>
   8:anim_gps.c    **** #include <math.h>
   9:anim_gps.c    **** 
  10:anim_gps.c    **** #include "util.h"
  11:anim_gps.c    **** #include "ratt.h"
  12:anim_gps.c    **** #include "ks0108.h"
  13:anim_gps.c    **** #include "glcd.h"
  14:anim_gps.c    **** 
  15:anim_gps.c    **** #ifdef GPSENABLE
  16:anim_gps.c    **** extern volatile uint8_t gpsenable;
  17:anim_gps.c    **** extern volatile int8_t timezone;
  18:anim_gps.c    **** extern volatile uint8_t just_pressed;
  19:anim_gps.c    **** extern volatile uint8_t displaystyle;
  20:anim_gps.c    **** extern volatile uint8_t displaymode;
  21:anim_gps.c    **** 
  22:anim_gps.c    **** uint8_t GPS_Text[] PROGMEM = "\x0A" "GPS Setup\0"
  23:anim_gps.c    **** 	                 "\x01" "\0"
  24:anim_gps.c    **** 	                 "\x0B" "Offset  : \0"
  25:anim_gps.c    **** 	                 "\x11" "Status  : NOLOCK\0"
  26:anim_gps.c    **** 	                 "\x0B" "GPS Date: \0"
  27:anim_gps.c    **** 	                 "\x15" "GPS Time:        UTC\0"
  28:anim_gps.c    **** 	                 "\x01" "\0"
  29:anim_gps.c    **** 	                 "\x14" "Menu=Exit, Set=-, +";
  30:anim_gps.c    **** 	                 
  31:anim_gps.c    **** 
  32:anim_gps.c    **** void initanim_GPS(void){
 141               	.LM0:
 142               	.LFBB1:
 143 0000 0F93      		push r16
 144 0002 1F93      		push r17
 145 0004 CF93      		push r28
 146 0006 DF93      		push r29
 147               	/* prologue: function */
 148               	/* frame size = 0 */
  33:anim_gps.c    ****  uint8_t UpdateTZ =1;
  34:anim_gps.c    ****  uint8_t i,j;
  35:anim_gps.c    ****  timezone=(int8_t)eeprom_read_byte(&EE_TIMEZONE);
 150               	.LM1:
 151 0008 80E0      		ldi r24,lo8(EE_TIMEZONE)
 152 000a 90E0      		ldi r25,hi8(EE_TIMEZONE)
 153 000c 0E94 0000 		call __eerd_byte_m328p
 154 0010 8093 0000 		sts timezone,r24
  36:anim_gps.c    ****  glcdClearScreen();
 156               	.LM2:
 157 0014 0E94 0000 		call glcdClearScreen
 158 0018 00E0      		ldi r16,lo8(0)
 159 001a 10E0      		ldi r17,lo8(0)
 160 001c 00C0      		rjmp .L2
 161               	.L3:
  37:anim_gps.c    ****  for(i=0,j=0;i<8;i++)
  38:anim_gps.c    ****  {
  39:anim_gps.c    ****  	 if(i) glcdSetAddress(MENU_INDENT, i);
 163               	.LM3:
 164 001e 88E0      		ldi r24,lo8(8)
 165 0020 602F      		mov r22,r16
 166 0022 0E94 0000 		call glcdSetAddress
 167               	.L2:
  40:anim_gps.c    ****      glcdPutStr_rom(&GPS_Text[j+1] ,NORMAL);
 169               	.LM4:
 170 0026 C12F      		mov r28,r17
 171 0028 D0E0      		ldi r29,lo8(0)
 172 002a CE01      		movw r24,r28
 173 002c 8050      		subi r24,lo8(-(GPS_Text+1))
 174 002e 9040      		sbci r25,hi8(-(GPS_Text+1))
 175 0030 60E0      		ldi r22,lo8(0)
 176 0032 0E94 0000 		call glcdPutStr_rom
 177               	.LBB2:
  41:anim_gps.c    ****      j+=pgm_read_byte(&GPS_Text[j])+1;
 179               	.LM5:
 180 0036 C050      		subi r28,lo8(-(GPS_Text))
 181 0038 D040      		sbci r29,hi8(-(GPS_Text))
 182 003a FE01      		movw r30,r28
 183               	/* #APP */
 184               	 ;  42 "anim_gps.c" 1
 185 003c 8491      		lpm r24, Z
 186               		
 187               	 ;  0 "" 2
 188               	/* #NOAPP */
 189               	.LBE2:
 190 003e 180F      		add r17,r24
 191 0040 1F5F      		subi r17,lo8(-(1))
  38:anim_gps.c    ****  for(i=0,j=0;i<8;i++)
 193               	.LM6:
 194 0042 0F5F      		subi r16,lo8(-(1))
 195 0044 0830      		cpi r16,lo8(8)
 196 0046 01F4      		brne .L3
 197 0048 91E0      		ldi r25,lo8(1)
  42:anim_gps.c    ****  }
  43:anim_gps.c    ****  while (1) {
  44:anim_gps.c    ****   // Must get a good test to enable gps
  45:anim_gps.c    ****   // read buttons
  46:anim_gps.c    ****   if (just_pressed) {
  47:anim_gps.c    ****    switch (just_pressed) {
  48:anim_gps.c    ****     case 4: if (++timezone>56) {timezone=56;}
  49:anim_gps.c    ****             UpdateTZ=1;
  50:anim_gps.c    ****             break;
  51:anim_gps.c    ****     case 2: if (--timezone<-48) {timezone=-48;}
 199               	.LM7:
 200 004a 00ED      		ldi r16,lo8(-48)
  49:anim_gps.c    ****     case 4: if (++timezone>56) {timezone=56;}
 202               	.LM8:
 203 004c 18E3      		ldi r17,lo8(56)
 204               	.L18:
  47:anim_gps.c    ****   if (just_pressed) {
 206               	.LM9:
 207 004e 8091 0000 		lds r24,just_pressed
 208 0052 8823      		tst r24
 209 0054 01F0      		breq .L4
  48:anim_gps.c    ****    switch (just_pressed) {
 211               	.LM10:
 212 0056 8091 0000 		lds r24,just_pressed
 213 005a 8230      		cpi r24,lo8(2)
 214 005c 01F0      		breq .L7
 215 005e 8430      		cpi r24,lo8(4)
 216 0060 01F0      		breq .L8
 217 0062 8130      		cpi r24,lo8(1)
 218 0064 01F4      		brne .L5
 219 0066 00C0      		rjmp .L20
 220               	.L8:
  49:anim_gps.c    ****     case 4: if (++timezone>56) {timezone=56;}
 222               	.LM11:
 223 0068 8091 0000 		lds r24,timezone
 224 006c 8F5F      		subi r24,lo8(-(1))
 225 006e 8093 0000 		sts timezone,r24
 226 0072 8091 0000 		lds r24,timezone
 227 0076 8933      		cpi r24,lo8(57)
 228 0078 04F0      		brlt .L9
 229 007a 1093 0000 		sts timezone,r17
 230 007e 00C0      		rjmp .L9
 231               	.L7:
 233               	.LM12:
 234 0080 8091 0000 		lds r24,timezone
 235 0084 8150      		subi r24,lo8(-(-1))
 236 0086 8093 0000 		sts timezone,r24
 237 008a 8091 0000 		lds r24,timezone
 238 008e 803D      		cpi r24,lo8(-48)
 239 0090 04F4      		brge .L9
 240 0092 0093 0000 		sts timezone,r16
 241 0096 00C0      		rjmp .L9
 242               	.L20:
  52:anim_gps.c    ****             UpdateTZ=1;
  53:anim_gps.c    ****             break;
  54:anim_gps.c    ****     case 1: displaystyle=eeprom_read_byte(&EE_STYLE); glcdClearScreen(); displaymode = CFG_MENU; re
 244               	.LM13:
 245 0098 80E0      		ldi r24,lo8(EE_STYLE)
 246 009a 90E0      		ldi r25,hi8(EE_STYLE)
 247 009c 0E94 0000 		call __eerd_byte_m328p
 248 00a0 8093 0000 		sts displaystyle,r24
 249 00a4 0E94 0000 		call glcdClearScreen
 250 00a8 82E6      		ldi r24,lo8(98)
 251 00aa 8093 0000 		sts displaymode,r24
 252               	/* epilogue start */
  55:anim_gps.c    ****    }
  56:anim_gps.c    ****    just_pressed=0;
  57:anim_gps.c    ****   }
  58:anim_gps.c    ****   // display
  59:anim_gps.c    ****   if (UpdateTZ) {
  60:anim_gps.c    ****    UpdateTZ=0;
  61:anim_gps.c    ****    eeprom_write_byte(&EE_TIMEZONE, timezone);
  62:anim_gps.c    ****    glcdSetAddress(45+MENU_INDENT,2);
  63:anim_gps.c    ****    if(timezone<0)
  64:anim_gps.c    ****    	   glcdPutStr("-",NORMAL);
  65:anim_gps.c    ****    else
  66:anim_gps.c    ****    	   glcdPutStr("+",NORMAL);
  67:anim_gps.c    ****    //glcdPutStr((timezone<0 ? "-" : "+"),NORMAL);
  68:anim_gps.c    ****    printnumber(TIMEZONEHOUR,NORMAL);
  69:anim_gps.c    ****    glcdPutStr(":",NORMAL);
  70:anim_gps.c    ****    printnumber(TIMEZONEMIN,NORMAL);
  71:anim_gps.c    ****    
  72:anim_gps.c    ****   }
  73:anim_gps.c    ****   // read gps 
  74:anim_gps.c    ****   //GPSRead(1); //1 if debugging to screen on line 5
  75:anim_gps.c    ****   //Hooked GPSRead elsewhere, that is quick enough for actual use.
  76:anim_gps.c    ****   // display
  77:anim_gps.c    ****   //_delay_ms(500);
  78:anim_gps.c    ****  }
  79:anim_gps.c    **** }
 254               	.LM14:
 255 00ae DF91      		pop r29
 256 00b0 CF91      		pop r28
 257 00b2 1F91      		pop r17
 258 00b4 0F91      		pop r16
 259 00b6 0895      		ret
 260               	.L9:
  55:anim_gps.c    ****    }
 262               	.LM15:
 263 00b8 91E0      		ldi r25,lo8(1)
 264               	.L5:
  57:anim_gps.c    ****    just_pressed=0;
 266               	.LM16:
 267 00ba 1092 0000 		sts just_pressed,__zero_reg__
 268               	.L4:
  60:anim_gps.c    ****   if (UpdateTZ) {
 270               	.LM17:
 271 00be 9923      		tst r25
 272 00c0 01F0      		breq .L18
  62:anim_gps.c    ****    eeprom_write_byte(&EE_TIMEZONE, timezone);
 274               	.LM18:
 275 00c2 6091 0000 		lds r22,timezone
 276 00c6 80E0      		ldi r24,lo8(EE_TIMEZONE)
 277 00c8 90E0      		ldi r25,hi8(EE_TIMEZONE)
 278 00ca 0E94 0000 		call __eewr_byte_m328p
  63:anim_gps.c    ****    glcdSetAddress(45+MENU_INDENT,2);
 280               	.LM19:
 281 00ce 85E3      		ldi r24,lo8(53)
 282 00d0 62E0      		ldi r22,lo8(2)
 283 00d2 0E94 0000 		call glcdSetAddress
  64:anim_gps.c    ****    if(timezone<0)
 285               	.LM20:
 286 00d6 8091 0000 		lds r24,timezone
 287 00da 87FF      		sbrs r24,7
 288 00dc 00C0      		rjmp .L11
  65:anim_gps.c    ****    	   glcdPutStr("-",NORMAL);
 290               	.LM21:
 291 00de 80E0      		ldi r24,lo8(__c.2124)
 292 00e0 90E0      		ldi r25,hi8(__c.2124)
 293 00e2 00C0      		rjmp .L19
 294               	.L11:
  67:anim_gps.c    ****    	   glcdPutStr("+",NORMAL);
 296               	.LM22:
 297 00e4 80E0      		ldi r24,lo8(__c.2126)
 298 00e6 90E0      		ldi r25,hi8(__c.2126)
 299               	.L19:
 300 00e8 60E0      		ldi r22,lo8(0)
 301 00ea 0E94 0000 		call glcdPutStr_rom
  69:anim_gps.c    ****    printnumber(TIMEZONEHOUR,NORMAL);
 303               	.LM23:
 304 00ee 8091 0000 		lds r24,timezone
 305 00f2 9927      		clr r25
 306 00f4 87FD      		sbrc r24,7
 307 00f6 9095      		com r25
 308 00f8 97FF      		sbrs r25,7
 309 00fa 00C0      		rjmp .L13
 310 00fc 9095      		com r25
 311 00fe 8195      		neg r24
 312 0100 9F4F      		sbci r25,lo8(-1)
 313               	.L13:
 314 0102 9595      		asr r25
 315 0104 8795      		ror r24
 316 0106 9595      		asr r25
 317 0108 8795      		ror r24
 318 010a 60E0      		ldi r22,lo8(0)
 319 010c 0E94 0000 		call printnumber
  70:anim_gps.c    ****    glcdPutStr(":",NORMAL);
 321               	.LM24:
 322 0110 80E0      		ldi r24,lo8(__c.2128)
 323 0112 90E0      		ldi r25,hi8(__c.2128)
 324 0114 60E0      		ldi r22,lo8(0)
 325 0116 0E94 0000 		call glcdPutStr_rom
  71:anim_gps.c    ****    printnumber(TIMEZONEMIN,NORMAL);
 327               	.LM25:
 328 011a 8091 0000 		lds r24,timezone
 329 011e 282F      		mov r18,r24
 330 0120 3327      		clr r19
 331 0122 27FD      		sbrc r18,7
 332 0124 3095      		com r19
 333 0126 37FF      		sbrs r19,7
 334 0128 00C0      		rjmp .L14
 335 012a 3095      		com r19
 336 012c 2195      		neg r18
 337 012e 3F4F      		sbci r19,lo8(-1)
 338               	.L14:
 339 0130 2370      		andi r18,lo8(3)
 340 0132 3070      		andi r19,hi8(3)
 341 0134 C901      		movw r24,r18
 342 0136 34E0      		ldi r19,4
 343 0138 880F      	1:	lsl r24
 344 013a 991F      		rol r25
 345 013c 3A95      		dec r19
 346 013e 01F4      		brne 1b
 347 0140 821B      		sub r24,r18
 348 0142 60E0      		ldi r22,lo8(0)
 349 0144 0E94 0000 		call printnumber
 350 0148 90E0      		ldi r25,lo8(0)
 351 014a 00C0      		rjmp .L18
 361               	.Lscope1:
 363               		.stabd	78,0,0
 364               	.global	GPS_Text
 365               		.section	.progmem.data,"a",@progbits
 368               	GPS_Text:
 369 0000 0A47 5053 		.string	"\nGPS Setup"
 369      2053 6574 
 369      7570 00
 370 000b 0100      		.string	"\001"
 371 000d 0B4F 6666 		.string	"\013Offset  : "
 371      7365 7420 
 371      203A 2000 
 372 0019 1153 7461 		.string	"\021Status  : NOLOCK"
 372      7475 7320 
 372      203A 204E 
 372      4F4C 4F43 
 372      4B00 
 373 002b 0B47 5053 		.string	"\013GPS Date: "
 373      2044 6174 
 373      653A 2000 
 374 0037 1547 5053 		.string	"\025GPS Time:        UTC"
 374      2054 696D 
 374      653A 2020 
 374      2020 2020 
 374      2020 5554 
 375 004d 0100      		.string	"\001"
 376 004f 144D 656E 		.string	"\024Menu=Exit, Set=-, +"
 376      753D 4578 
 376      6974 2C20 
 376      5365 743D 
 376      2D2C 202B 
 379               	__c.2128:
 380 0064 3A00      		.string	":"
 383               	__c.2126:
 384 0066 2B00      		.string	"+"
 387               	__c.2124:
 388 0068 2D00      		.string	"-"
 393               		.text
 395               	.Letext0:
DEFINED SYMBOLS
                            *ABS*:00000000 anim_gps.c
     /tmp/ccqCUZ0a.s:2      *ABS*:0000003f __SREG__
     /tmp/ccqCUZ0a.s:3      *ABS*:0000003e __SP_H__
     /tmp/ccqCUZ0a.s:4      *ABS*:0000003d __SP_L__
     /tmp/ccqCUZ0a.s:5      *ABS*:00000034 __CCP__
     /tmp/ccqCUZ0a.s:6      *ABS*:00000000 __tmp_reg__
     /tmp/ccqCUZ0a.s:7      *ABS*:00000001 __zero_reg__
     /tmp/ccqCUZ0a.s:138    .text:00000000 initanim_GPS
     /tmp/ccqCUZ0a.s:368    .progmem.data:00000000 GPS_Text
     /tmp/ccqCUZ0a.s:387    .progmem.data:00000068 __c.2124
     /tmp/ccqCUZ0a.s:383    .progmem.data:00000066 __c.2126
     /tmp/ccqCUZ0a.s:379    .progmem.data:00000064 __c.2128

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
EE_TIMEZONE
__eerd_byte_m328p
timezone
glcdClearScreen
glcdSetAddress
glcdPutStr_rom
just_pressed
EE_STYLE
displaystyle
displaymode
__eewr_byte_m328p
printnumber
